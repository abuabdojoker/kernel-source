From: Jiri Slaby <jslaby@suse.cz>
Subject: xen: Linux 3.12.50
Patch-mainline: Never, SUSE-Xen specific
References: CVE-2015-7613 LTC#129509 bnc#853495 bnc#932348 bnc#938024 bnc#941908 bnc#943476 bnc#944028 bnc#946906 bnc#949463 bsc#931538 bsc#947537 bsc#948256 bsc#948536 bsc#951199 bnc#942204

Signed-off-by: Jiri Slaby <jslaby@suse.cz>
Automatically created from "patches.kernel.org/patch-3.12.49-50" by xen-port-patches.py

--- a/arch/x86/mm/init_64-xen.c
+++ b/arch/x86/mm/init_64-xen.c
@@ -1459,7 +1459,7 @@ void mark_rodata_ro(void)
 #else
 	all_end = roundup((unsigned long)_brk_end, PMD_SIZE);
 #endif
-	set_memory_nx(rodata_start, (all_end - rodata_start) >> PAGE_SHIFT);
+	set_memory_nx(text_end, (all_end - text_end) >> PAGE_SHIFT);
 
 	rodata_test();
 
--- a/include/xen/interface/sched.h
+++ b/include/xen/interface/sched.h
@@ -160,7 +160,15 @@ DEFINE_XEN_GUEST_HANDLE(sched_watchdog_t
 #define SHUTDOWN_suspend    2  /* Clean up, save suspend info, kill.         */
 #define SHUTDOWN_crash      3  /* Tell controller we've crashed.             */
 #define SHUTDOWN_watchdog   4  /* Restart because watchdog time expired.     */
-#define SHUTDOWN_MAX        4  /* Maximum valid shutdown reason.             */
+/*
+ * Domain asked to perform 'soft reset' for it. The expected behavior is to
+ * reset internal Xen state for the domain returning it to the point where it
+ * was created but leaving the domain's memory contents and vCPU contexts
+ * intact. This will allow the domain to start over and set up all Xen specific
+ * interfaces again.
+ */
+#define SHUTDOWN_soft_reset 5
+#define SHUTDOWN_MAX        5  /* Maximum valid shutdown reason.             */
 /* ` } */
 
 #endif /* __XEN_PUBLIC_SCHED_H__ */
