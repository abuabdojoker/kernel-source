From: jbeulich@suse.com
Subject: fix pCPU handling
Patch-mainline: Never, SUSE-Xen specific
References: luckily none so far

Introduction of
patches.fixes/0017-acpi-processor-introduce-apic_id-in-struct-processor-to-save-parsed-apic-id
required dropping some changes done in xen3-patch-2.6.28 and
xen3-patch-3.3. While doing so I overlooked the need to also adjust
callers of acpi_get_cpuid() accordingly.

--- a/drivers/acpi/acpi_processor.c
+++ b/drivers/acpi/acpi_processor.c
@@ -292,8 +292,8 @@ static int acpi_processor_get_info(struc
 	if (pr->id == -1) {
 		int ret = acpi_processor_hotadd_init(pr, device_declaration);
 		if (ret && (ret != -ENODEV ||
-			    acpi_get_cpuid(pr->handle, ~device_declaration,
-					   pr->acpi_id) < 0))
+			    acpi_get_apicid(pr->handle, device_declaration,
+					    pr->acpi_id) < 0))
 			return ret;
 	}
 #if defined(CONFIG_SMP) && defined(CONFIG_PROCESSOR_EXTERNAL_CONTROL)
--- a/drivers/acpi/processor_core.c
+++ b/drivers/acpi/processor_core.c
@@ -312,8 +312,9 @@ static bool __init processor_physically_
 
 	type = (acpi_type == ACPI_TYPE_DEVICE) ? 1 : 0;
 	if (processor_cntl_external())
-		type = ~type;
-	cpuid = acpi_get_cpuid(handle, type, acpi_id);
+		cpuid = acpi_get_apicid(handle, type, acpi_id);
+	else
+		cpuid = acpi_get_cpuid(handle, type, acpi_id);
 
 	if (cpuid == -1)
 		return false;
