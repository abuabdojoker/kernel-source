From: Jeff Mahoney <jeffm@suse.com>
Subject: kabi fix for patches.fixes/reduce-m_start-cost
References: bsc#966573
Patch-mainline: Never, kABI fix

struct mnt_namespace is an opaque pointer when used outside of fs/*.c,
but is included in the kABI via task_struct->nsproxy->mnt_namespace.  That
results in false alarms from the kABI checker.

Signed-off-by: Jeff Mahoney <jeffm@suse.com>
---
 fs/mount.h |   10 ++++++++++
 1 file changed, 10 insertions(+)

--- a/fs/mount.h
+++ b/fs/mount.h
@@ -10,7 +10,17 @@ struct mnt_namespace {
 	struct user_namespace	*user_ns;
 	u64			seq;	/* Sequence number to prevent loops */
 	wait_queue_head_t poll;
+#ifdef __GENKSYMS__
+	/*
+	 * This is to fix kABI false alarms in fs/ source files where
+	 * the type is fully defined.  It's included in the kABI due to
+	 * task_struct->nsproxy->mnt_namespace but is a forward declared
+	 * (opaque) pointer everywhere else.
+	 */
+	int event;
+#else
 	u64 event;
+#endif
 };
 
 struct mnt_pcp {
